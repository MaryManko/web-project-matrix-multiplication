<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Distributed Calculator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">
    <h1 class="text-center mb-4">–°–∏—Å—Ç–µ–º–∞ –†–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–∏—Ö –û–±—á–∏—Å–ª–µ–Ω—å</h1>

    <div class="card p-4 shadow-sm">
        <div class="row g-3 align-items-center">
            <div class="col-auto">
                <label for="matrixSize" class="col-form-label">–†–æ–∑–º—ñ—Ä –º–∞—Ç—Ä–∏—Ü—ñ:</label>
            </div>
            <div class="col-auto">
                <input type="number" id="matrixSize" class="form-control" value="100">
            </div>
            <div class="col-auto">
                <button onclick="createTask()" class="btn btn-primary">–ó–∞–ø—É—Å—Ç–∏—Ç–∏ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è</button>
            </div>
        </div>
    </div>

    <h3 class="mt-5">–Ü—Å—Ç–æ—Ä—ñ—è –ó–∞–¥–∞—á</h3>
    <table class="table table-striped mt-3 bg-white shadow-sm rounded">
        <thead>
            <tr>
                <th>ID</th>
                <th>–û–ø–∏—Å</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–ü—Ä–æ–≥—Ä–µ—Å</th>
                <th>–î—ñ—è</th> </tr>
        </thead>
        <tbody id="tasksTable">
            </tbody>
    </table>
</div>

<script>
    const API_URL = "http://127.0.0.1";
    // –§—É–Ω–∫—Ü—ñ—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–¥–∞—á—ñ
    async function createTask() {
        const size = document.getElementById('matrixSize').value;
        await fetch(`${API_URL}/tasks`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ matrix_size: parseInt(size) })
        });
        loadTasks(); // –û–¥—Ä–∞–∑—É –æ–Ω–æ–≤–∏—Ç–∏ —Å–ø–∏—Å–æ–∫
    }

    // –ù–û–í–ê —Ñ—É–Ω–∫—Ü—ñ—è —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è
    async function cancelTask(taskId) {
        if(!confirm('–¢–æ—á–Ω–æ –∑—É–ø–∏–Ω–∏—Ç–∏ –∑–∞–¥–∞—á—É?')) return;
        
        await fetch(`${API_URL}/tasks/${taskId}/cancel`, {
            method: 'POST'
        });
        loadTasks(); // –û–Ω–æ–≤–∏—Ç–∏ —Ç–∞–±–ª–∏—Ü—é
    }

    // –§—É–Ω–∫—Ü—ñ—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É –∑–∞–¥–∞—á (–í–ñ–ï –û–ù–û–í–õ–ï–ù–ê)
    async function loadTasks() {
        const response = await fetch(`${API_URL}/tasks`);
        const tasks = await response.json();
        
        const tableBody = document.getElementById('tasksTable');
        tableBody.innerHTML = ''; // –û—á–∏—Å—Ç–∏—Ç–∏ —Ç–∞–±–ª–∏—Ü—é –ø–µ—Ä–µ–¥ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º

        tasks.forEach(task => {
            // –í–∏–∑–Ω–∞—á–∞—î–º–æ –∫–æ–ª—ñ—Ä —Å—Ç–∞—Ç—É—Å—É
            let badgeColor = 'secondary';
            if (task.status === 'Processing') badgeColor = 'warning';
            if (task.status === 'Completed') badgeColor = 'success';
            if (task.status === 'Error') badgeColor = 'danger';
            if (task.status === 'Cancelled') badgeColor = 'dark'; // –ß–æ—Ä–Ω–∏–π –¥–ª—è —Å–∫–∞—Å–æ–≤–∞–Ω–∏—Ö

            // –õ–æ–≥—ñ–∫–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–°–∫–∞—Å—É–≤–∞—Ç–∏"
            let actionButton = '';
            // –ö–Ω–æ–ø–∫—É –ø–æ–∫–∞–∑—É—î–º–æ —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ –∑–∞–¥–∞—á–∞ —â–µ —Ä–æ–±–∏—Ç—å—Å—è –∞–±–æ —á–µ–∫–∞—î
            if (task.status === 'Processing' || task.status === 'Pending') {
                actionButton = `
                    <button onclick="cancelTask(${task.id})" class="btn btn-danger btn-sm">
                        –°—Ç–æ–ø üõë
                    </button>
                `;
            }

            // –ú–∞–ª—é—î–º–æ —Ä—è–¥–æ–∫ —Ç–∞–±–ª–∏—Ü—ñ
            const row = `
                <tr>
                    <td>${task.id}</td>
                    <td>${task.description}</td>
                    <td><span class="badge bg-${badgeColor}">${task.status}</span></td>
                    <td>
                        <div class="progress" style="height: 20px;">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                 role="progressbar" 
                                 style="width: ${task.progress}%">
                                 ${task.progress}%
                            </div>
                        </div>
                    </td>
                    <td>${actionButton}</td>
                </tr>
            `;
            tableBody.innerHTML += row;
        });
    }

    // –ó–∞–ø—É—Å–∫–∞—î–º–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–∂–Ω—ñ 2 —Å–µ–∫—É–Ω–¥–∏
    setInterval(loadTasks, 2000);
    loadTasks(); // –ü–µ—Ä—à–∏–π –∑–∞–ø—É—Å–∫ –æ–¥—Ä–∞–∑—É
</script>

</body>
</html>